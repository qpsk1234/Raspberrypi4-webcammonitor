# 要件定義：Raspberry Pi 4 人間検知監視カメラアプリ

## 1. 目的
Raspberry Pi 4上で動作し、リアルタイムで人間を検知できる監視カメラアプリケーションを開発する。
検知時の通知・録画に加え、ブラウザから設定・状態確認ができるWeb管理画面を提供する。

## 2. 機能要件

### 2.1 映像入力
- **リアルタイムカメラフィード**: カメラ（USBまたはCSI接続）からの映像ソースを取得し処理する。

### 2.2 人間検知
- **人間検知**: TensorFlow Liteを使用して、フレーム内の人間を識別する。
- **検知閾値**: 確信度（Confidence）の閾値をブラウザ画面から動的に変更できる。

### 2.3 出力・通知
- **アラート/通知**: 人間を検知した際に Telegram Bot 経由で検知画像を送信する。
- **録画**: 検知時に動画または画像を指定ディレクトリへ保存する。
- **ローカルモニター出力**: GUIが利用可能な環境では `cv2.imshow()` で映像を表示する（ヘッドレス環境では自動無効化）。
- **Webストリーミング**: ブラウザから映像をリアルタイムで視聴できる（MJPEG形式）。

### 2.4 Web管理画面
- **設定画面**: ブラウザから以下の設定を変更・保存できる。
    - 検知閾値（Confidence スライダー）
    - 通知間隔（秒）
    - ストリーム表示解像度（幅×高さ）
    - Telegram Bot Token / Chat ID
- **動作ステータス表示**: 以下の情報をリアルタイム（2秒間隔）で表示する。
    - システム稼働状態
    - フレーム内の人数
    - 累計検知回数
    - 最終検知日時
    - FPS / 解像度
- **人間検知アラート**: 検知中は画面上でアラートバナーを表示する。

## 3. 非機能要件
- **パフォーマンス**: Raspberry Pi 4上で実用的なフレームレート（FPS）で処理可能であること。
- **低遅延**: 検知は最小限の遅延で行われること。
- **堅牢性**: 継続的に動作し、GUIなし環境でも正常稼働すること。
- **設定の永続化**: 設定は `config.json` に保存され、再起動後も引き継がれること。

## 4. ユーザーストーリー
- ユーザーとして、侵入者が検知されたときに Telegram で通知を受け取りたい。
- ユーザーとして、ストレージを節約するために人がいるときだけ録画したい。
- ユーザーとして、ブラウザから映像を確認したい。
- ユーザーとして、ブラウザから検知閾値やTelegram設定を変更・保存したい。
- ユーザーとして、現在のシステム状態（FPS、検知数など）をリアルタイムで把握したい。

## 5. スコープ
- 対象プラットフォーム: Raspberry Pi 4（ヘッドレス環境対応）
- 言語: Python 3.9+
- 主要フォーカス: 人間検知の精度・効率・使いやすい管理UI
